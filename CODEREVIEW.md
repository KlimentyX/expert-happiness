# Процесс ревью кода

<!-- generate-toc start -->
<!-- См. https://github.com/hhru/frontend/blob/master/utils/generate-toc.js -->

- [Общие положения](#Общие-положения)
- [Цели ревью](#Цели-ревью)
- [Подготовка к ревью](#Подготовка-к-ревью)
- [Выбор ревьюера](#Выбор-ревьюера)
- [Процесс ревью, общие положения](#Процесс-ревью-общие-положения)
- [Процесс ревью со стороны автора кода](#Процесс-ревью-со-стороны-автора-кода)
- [Процесс ревью со стороны ревьюера](#Процесс-ревью-со-стороны-ревьюера)
- [Использованные материалы и ссылки по теме](#Использованные-материалы-и-ссылки-по-теме)

<!-- generate-toc end -->

## Общие положения

- <a id="hh-review-github-pr"></a>В Хэдхантере ревью проходит в формате [пулл-реквестов](https://help.github.com/articles/using-pull-requests/) на Гитхабе. [¶](#hh-review-github-pr)

- <a id="hh-review-required"></a>Ревью и пулл-реквесты обязательны, даже если в рамках задачи меняется одна строчка или один символ в коде. [¶](#hh-review-required)

- <a id="hh-review-reviewer"></a>У каждой задачи должен быть, как минимум, один ответственный ревьюер, он указывается в задаче в качестве ревьюера и несёт ответственность за код как и автор. Не запрещено, и приветствуется, участие в ревью других людей. [¶](#hh-review-reviewer)

- <a id="hh-review-responsibility"></a>Ответственность провести задачу через ревью лежит на авторе задачи. [¶](#hh-review-responsibility)

- <a id="hh-review-rereview"></a>Любые изменения после ревью, например, правки во время тестирования точно также должны быть проревьюены. [¶](#hh-review-rereview)


## Цели ревью

- <a id="hh-review-experience"></a>Распространение опыта и знаний между разработчиками. [¶](#hh-review-experience)

- <a id="hh-review-improve"></a>Поддержка принципа — изменения не должны ухудшать уже существующий код, они должны его улучшать. [¶](#hh-review-improve)

- <a id="hh-review-logic"></a>Исправление ошибок в логике и ошибок связанных с безопасностью, корректную обработку исключений. [¶](#hh-review-logic)

- <a id="hh-review-quality"></a>Улучшение качества кода, maintainability и архитектуры проекта. [¶](#hh-review-quality)

- <a id="hh-review-improve-readability"></a>Улучшение читабельности кода. [¶](#hh-review-improve-readability)

- <a id="hh-review-tests"></a>Улучшение покрытия тестами и тестирование на нужном уровне. [¶](#hh-review-tests)

- <a id="hh-review-docs"></a>Улучшение документации. [¶](#hh-review-docs)

- <a id="hh-review-useful"></a>Соответствие изменений требованиям в задаче. [¶](#hh-review-useful)

- <a id="hh-review-no-debt"></a>Предотвращение появления технического долга или технического налога. [¶](#hh-review-no-debt)

- <a id="hh-review-api"></a>Продуманный дизайн API, где API — это любой модуль с внешним интерфейсом. Например, что ресурс в hh-xmlback имеет продуманный URL, удобный формат JSON, корректные коды ответов в разных случаях и так далее. [¶](#hh-review-api)

- <a id="hh-review-history"></a>Корректная история коммитов в Гите, с отражающими суть сообщениями, без временных коммитов. [¶](#hh-review-history)


## Подготовка к ревью

- <a id="hh-review-check-all"></a>Перед публикацией пулл-реквеста 2-3 раза прочитайте свой код, с большой вероятностью вы найдёте там ошибки, что сэкономит время ревьюеру. Проверьте что нет ошибок, которые могут быть выявлены автоматически — ошибки в стиле кода, упавшие тесты. Удостоверьтесь, что в коде нет временных комментариев и отладочного кода, а также проверьте соответствие вашего кода принятым [стайл-гайдам](https://github.com/hhru/docs/tree/master/docs). [¶](#hh-review-check-all)

- <a id="hh-review-haste"></a>Если создаёте пулл-реквест в процессе работы над задачей, пропишите в заголовке пометку «[WIP]» и поставьте метку «work in progress». Когда работа закончена, уберите метки и проинформируйте об этом отдельным комментарием, чтобы заинтересованные лица узнали, что код можно смотреть. [¶](#hh-review-haste)

- <a id="hh-review-mini-demo"></a>Будьте готовы показать ревьюеру мини-демо по задаче. [¶](#hh-review-mini-demo)

- <a id="hh-review-lines"></a>Отдавайте на ревью небольшие порции кода. 200-300 строк изменений — предел для эффективного ревью. [¶](#hh-review-lines)

- <a id="hh-review-independent"></a>Оформляйте независимые изменения отдельными коммитами. [¶](#hh-review-independent)

- <a id="hh-review-commit-message"></a>Описывайте коммиты короткими и информативными сообщениями. [¶](#hh-review-commit-message)

- <a id="hh-review-refactoring"></a>Рефакторинг делайте отдельным коммитом, так легче увидеть изменения в логике, суть задачи. [¶](#hh-review-refactoring)

- <a id="hh-review-format"></a>Форматирование кода делайте отдельным коммитом *до* основных изменений, или даже отдельным пулл-реквестом. [¶](#hh-review-format)

- <a id="hh-review-changes"></a>Не коммитьте незначащие изменения. Например, добавление переносов строк в файле, в котором вы больше ничего не меняли. [¶](#hh-review-changes)

- <a id="hh-review-title"></a>В заголовке пулл-реквеста коротко и информативно опишите суть изменений. Не «Fix line-height in resume-progress-item», а «Fix excess line spacing in links in resume-builder sidebar». [¶](#hh-review-title)

- <a id="hh-review-description"></a>Опишите в пулл-реквесте проблему и решение. Опишите альтернативные варианты решения и почему выбрано текущее решение. Если изменения касаются интерфейса, приложите скриншоты «до» и «после». [¶](#hh-review-description)

- <a id="hh-review-task-link"></a>В пулл-реквесте дайте ссылку на задачу, а в задаче ссылку на пулл-реквест. [¶](#hh-review-task-link)


## Выбор ревьюера

- <a id="hh-review-proper"></a>Отдавайте задачу на ревью специалисту из соответствующей области. [¶](#hh-review-proper)

- <a id="hh-review-no-team"></a>Для фронтенд-задач ревьюер должен быть не из вашей команды. При этом рекомендуется предварительно показать задачу своей команде для ревью специфичной логики. [¶](#hh-review-no-team)

- <a id="hh-review-probation"></a>Сотрудник на испытательном сроке не может быть ответственным ревьюером, но может участвовать в процессе ревью. [¶](#hh-review-probation)

- <a id="hh-review-many-reviewers"></a>Не отдавайте все ваши задачи на ревью одним и тем же людям — просите ревью у разных людей. [¶](#hh-review-many-reviewers)

- <a id="hh-review-non-trivial"></a>Если в задаче затронут нетривиальный участок кода, в котором разбирается определённый человек, покажите изменения ему, независимо от того, кто ответственный ревьюер. Также помните, что у каждого репозитория есть меинтейнеры, они больше других знают об этом коде и курируют разработку. [¶](#hh-review-non-trivial)

- <a id="hh-review-random"></a>В остальном, ревьюер выбирается произвольно, по обоюдному согласию сторон. Старайтесь обращаться за ревью в команды, которые поддерживают или часто модифицируют страницу в рамках бизнес-задач. С одной стороны, ваши изменения проревьюит разработчик, который знает об особенностях кода; с другой стороны, это помогает командам узнавать о задачах других команд, которые затрагивают «их» функциональность. Выбрать команду поможет страница [распределение функциональности и багов по командам](https://wiki.hh.ru/pages/viewpage.action?pageId=70650830). В качестве альтернативы используйте [рекомендации на Гитхабе](https://help.github.com/articles/requesting-a-pull-request-review/), основанные на «блейме» затронутого кода. [¶](#hh-review-random)

- <a id="hh-review-reviewer"></a>После выбора ревьюера укажите его в качестве [Reviewer](https://help.github.com/articles/requesting-a-pull-request-review/) в пулл-реквесте. [Список](https://github.com/pulls/assigned) всех пулл-реквестов, которые на вас назначены. [¶](#hh-review-reviewer)

- <a id="hh-review-discuss-in-advance"></a>Иногда полезно обсудить выбранное решение с ревьюером до написания кода. Это поможет найти оптимальный вариант решения задачи и упростит процесс ревью. [¶](hh-review-discuss-in-advance)


## Процесс ревью, общие положения

Относится как к автору кода, так и к ревьюеру.

- <a id="hh-review-general"></a>Весь код общий, нет таких понятий как «мой код» или «твой код». Это значит, что за любую строчку кода отвечает каждый разработчик, а не только тот, кто эту строчку написал. [¶](#hh-review-general)

- <a id="hh-review-atmosphere"></a>Создавайте атмосферу взаимопонимания, будьте вежливы и дружелюбны, цените и уважайте друг друга, не навязывайте своё мнение. Прислушивайтесь к мнению оппонента и не стойте на своём из принципа. Не превращайте ревью в отрицательный опыт для коллег. [¶](#hh-review-atmosphere)

- <a id="hh-review-argumentation"></a>Задавайте вопросы, если что-то не понятно. Аргументируйте и конкретизируйте вопросы и ответы, автору кода может быть не очевидно, что подразумевается под вопросом «почему так?», а ревьюверу не понятна аргументация ответа «не согласен». [¶](#hh-review-argumentation)

- <a id="hh-review-time"></a>Не растягивайте процесс ревью, экономьте время, оперативно реагируйте на комментарии, обсуждайте устно, не провоцируйте длинные дискуссии и не разводите «холиваров», если вы не можете быстро придти к консенсусу обратитесь за помощью к коллегам, к меинтейнеру или руководителю функционального направления. [¶](#hh-review-time)

- <a id="hh-review-describe"></a>Если задача не на пару строк, потратьте с ревьюером 10-15 минут на совместный просмотр кода, полезно сделать это даже до создания пулл-реквеста. Обсудите суть задачи и решения, посмотрите как было и стало в работающем окружении. Это поможет ревьюеру лучше погрузиться в контекст задачи. Большинство комментариев останутся ненаписанными, что сэкономит всем время. [¶](#hh-review-describe)

- <a id="hh-review-synospis"></a>После устного обсуждения всегда описывайте принятое решение и доводы в пользу него в пулл-реквесте. Ответственность за описание лежит на авторе кода. [¶](#hh-review-synospis)

- <a id="hh-review-repeated"></a>Если в коде встречаются однотипные ошибки, ревьюеру следует акцентировать на этом внимание автора кода в первом или втором комментарии, не комментируя каждое вхождение, а автору анализировать код на предмет однотипных ошибок перед публикацией исправления. [¶](#hh-review-repeated)

- <a id="hh-review-compliment"></a>Хвалите за удачные решения автора и предложения ревьювера. [¶](#hh-review-compliment)

- <a id="hh-review-in-pr"></a>Оставляйте комментарии к изменениям в самом пулл-реквесте, а не к отдельным коммитам. Таким образом, вся переписка будет в одном месте, в том числе после ребейза. [¶](#hh-review-in-pr)

- <a id="hh-review-threads"></a>Отвечайте на комментарии в тех же ветках обсуждений, где они начаты. Если комментарий относится ко всему пулл-реквесту или в одной ветке несколько комментариев, цитируйте комментируемое сообщение. Чтобы из письма перейти на устаревшую ветку обсуждения вместо ссылки «view it on GitHub» используйте ссылку «in path/to/file». [¶](#hh-review-threads)

- <a id="hh-review-standards"></a>Если в процессе ревью приняты какие-либо кардинальные решения с точки зрения стандартов 
кодирования или иных оформленных договорённостей, на автора кода возлагается обязанность записать эти решения в соответствующих документах. [¶](#hh-review-standards)

- <a id="hh-review-design"></a>Ревью не только про код, а про задачу целиком. Не относитесь к требованиям в задаче или макетам как к истине в последней инстанции — все совершают ошибки и никто не может учесть все нюансы. Свежий взгляд и дельные предложения только пойдут продукту на пользу. [¶](#hh-review-design)


## Процесс ревью со стороны автора кода

- <a id="hh-review-one-task"></a>После передачи задачи в ревью, не переключайтесь на другие задачи. Задача не завершена, пока не прошла ревью, тестирование и выпуск на «прод». [¶](#hh-review-one-task)

- <a id="hh-review-reply-all"></a>Отвечайте на все комментарии ревьюера, не оставляйте комментарии без ответа, независимо от того приняли вы их или нет. [¶](#hh-review-reply-all)

- <a id="hh-review-questions"></a>Задумывайтесь над вопросами, которые возникают или могут возникнуть во время ревью. Возможно, участку кода не хватает комментария или код лучше написать более явно. [¶](#hh-review-questions)

- <a id="hh-review-no-amend"></a>Не исправляйте существующие коммиты «амендом» (`git commit --amend`), вместо этого вносите изменения отдельными коммитами, по одному на каждое исправление. Исправление существующих коммитов сильно затрудняет процесс ревью, так как приходится смотреть весь код заново. [¶](#hh-review-no-amend)

- <a id="hh-review-notify"></a>После добавления нового коммита к пулл-реквесту, напишите отдельным комментарием сводку об изменениях, чтобы заинтересованные лица были в курсе. Это касается как исправлений во время ревью, так и исправлений во время тестирования. [¶](#hh-review-notify)

- <a id="hh-review-rebase"></a>После ревью, перед отдачей задачи в тестирование, [перепишите историю](http://www.git-scm.com/book/en/v2/Git-Tools-Rewriting-History) коммитов (`git rebase --interactive`), внеся в отдельные коммиты соответствующие исправления и удалив временные коммиты. Обратите внимание на опцию `--autosquash` для упрощения процесса. [¶](#hh-review-rebase)


## Процесс ревью со стороны ревьюера

- <a id="hh-review-busy"></a>Если в момент просьбы поревьюить вы заняты, сообщите когда именно вы приступите к ревью. [¶](#hh-review-busy)

- <a id="hh-review-suggest"></a>Не *требуйте*, а *предлагайте* внести изменения. [¶](#hh-review-suggest)

- <a id="hh-review-no-personal"></a>Комментируйте код, а не человека, который его написал. [¶](#hh-review-no-personal)

- <a id="hh-review-abuse"></a>Вы берёте на себя ответственность за написанный код, подходите к ревью соответствующе, но это не значит, что автор кода должен неукоснительно выполнять все ваши требования. Помните, многие вещи можно сделать по разному. [¶](#hh-review-abuse)

- <a id="hh-review-not-critical"></a>Преследуйте [цели ревью](https://github.com/hhru/docs/blob/review-review/docs/review.md#Цели-ревью) и предлагайте правки по существу. Не настаивайте на некритичных изменениях. Указывайте важность исправлений в комментарии. [¶](#hh-review-not-critical)

- <a id="hh-review-critical"></a>Если вы нашли серьёзную проблему, приостановите ревью и дождитесь, пока автор её исправит. Вероятнее всего, после исправления, всё равно потребуется ревьюить заново. [¶](#hh-review-critical)

- <a id="hh-review-hidden"></a>Обращайте внимание не только на что было изменено, но и на то что не было изменено. Поищите и покажите автору код, который должен был быть изменён, но не был (забытые импорты или неиспользуемые классы, использование отрефакторенного кода в другом месте и прочее). [¶](#hh-review-hidden)

- <a id="hh-review-secondary"></a>После внесения изменений автором кода проревьюйте исправления и повторно просмотрите весь пулл-реквест. Возможно, с учётом исправлений, у вас появятся новые замечания или вопросы. [¶](#hh-review-secondary)

- <a id="hh-review-changed-only"></a>Не тратьте время на ревью кода, который не менялся в рамках задачи. Выделение части кода в функцию считается за изменение. Перенос кода «как есть» за изменение не считается. Реформат кода в затронутом файле на усмотрение автора. [¶](#hh-review-changed-only)

- <a id="hh-review-no-reviewer-coding"></a>Ревьюер не правит самостоятельно код в ветке, потому что ему так хочется или проще. Изменения вносит автор кода. [¶](#hh-review-no-reviewer-coding)


## Использованные материалы и ссылки по теме

- [Code Review Best Practices](http://kevinlondon.com/2015/05/05/code-review-best-practices.html) от Кевина Лондона
- [Why code review matters?](https://medium.com/@isnifer/why-code-review-matters-3e4ad5a9d978) от Антона Кузнецова
- [Code Reviews Can Make or Break Your Team](https://medium.com/swlh/code-reviews-can-make-or-break-your-team-a3cfdcc15de1) от Амира Ясина
- [The Ethics of Code Reviews](http://www.marcotroisi.com/the-ethics-of-code-reviews/) от Марко Троиси
- [Effective Code Reviews Without the Pain](http://www.developer.com/tech/article.php/3579756/Effective-Code-Reviews-Without-the-Pain.htm) от Роберта Боуга
- [MDN — Code Review FAQ](https://developer.mozilla.org/en-US/docs/Code_Review_FAQ) от Марсии Нюс и других
- [How to create a good pull request](https://blog.alphasmanifesto.com/2016/07/11/how-to-create-a-good-pull-request/)
- [How to perform a good code review](https://blog.alphasmanifesto.com/2016/11/17/how-to-perform-a-good-code-review/)
- [How to get faster PR reviews](https://github.com/kubernetes/community/blob/master/contributors/devel/faster_reviews.md) от Тима Хокина и других
- [Top ten pull request review mistakes](https://blog.scottnonnenberg.com/top-ten-pull-request-review-mistakes/) от Скота Нонеберга
- [Code review in remote teams](https://web.hypothes.is/blog/code-review-in-remote-teams/) от Шона Хаммонда
- [May the Code Review be with you](https://habrahabr.ru/company/avito/blog/330846/) от Егора Толстого
- [Как я научился делать мир лучше в HeadHunter](https://habrahabr.ru/company/hh/blog/258933/) от Ивана Баранова
- [Автовыбиратель ревьюера для фронтенд-задач](http://output.jsbin.com/xeraze) от Ивана Петропольского
